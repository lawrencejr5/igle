<!DOCTYPE html>
<html>
  <head>
    <title>Rider Socket Test</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  </head>
  <body>
    <h2>Rider App</h2>
    <button onclick="requestRide()">Send Ride Request</button>
    <h4>Rider location</h4>
    <p id="location"></p>
    <script>
      const socket = io("http://localhost:5000");

      socket.on("connect", () => {
        console.log("Connected as Rider:", socket.id);
        const data = {
          socket_id: socket.id,
          user_id: "687ffcf8c8676401f6f1d547",
        };
        socket.emit("register_user", data);
      });

      socket.on("ride_accepted", (data) => {
        console.log("Ride accepted by driver:", data);
        alert("Driver accepted your ride!");
      });

      socket.on("ride_cancel", (data) => {
        console.log(`Ride cancelled by ${data.by}`);
        alert(`Ride cancelled by ${data.by}`);
      });

      socket.on("ride_arrival", (data) => {
        console.log(data.msg);
        alert(data.msg);
      });

      socket.on("ride_in_progress", (data) => {
        console.log(data.msg);
        alert(data.msg);
      });

      socket.on("ride_completed", (data) => {
        console.log(data.msg);
        alert(data.msg);
      });

      socket.on("ride_timeout", (data) => {
        console.log(data.msg);
        alert(data.msg);
      });

      socket.on("driver_location_update", (data) => {
        document.getElementById("location").innerHTML = data.coordinates;
      });

      function requestRide() {
        const payload = {
          rider_id: "687ffcf8c8676401f6f1d547",
          rider_socket_id: socket.id,
          pickup: {
            address: "Lekki Phase 1",
            coordinates: [6.4367, 3.4505],
          },
          destination: {
            address: "Victoria Island",
            coordinates: [6.4281, 3.4216],
          },
        };

        socket.emit("ride_request", payload);
        console.log("Ride request sent:", payload);
      }
    </script>
  </body>
</html>
